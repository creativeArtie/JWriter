package com.creativeartie.jwriter.window;

import java.util.*;
import javafx.stage.*;
import javafx.scene.layout.*;
import javafx.beans.property.*;
import javafx.beans.binding.*;
import org.fxmisc.richtext.model.*;

import com.creativeartie.jwriter.main.*;
import com.creativeartie.jwriter.file.*;
import com.creativeartie.jwriter.lang.*;
import com.creativeartie.jwriter.lang.markup.*;
import com.creativeartie.jwriter.property.window.*;

import com.google.common.collect.*;

abstract class WriterSceneView extends BorderPane{
    private TextPaneControl textArea;
    private HeadingPaneControl tableOfContent;
    private AgendaPaneControl agendaPane;
    private NotesPaneControl userLists;
    private CheatsheetPaneControl langCheatsheet;
    private SimpleObjectProperty<ManuscriptFile> manuscriptFile;
    private SimpleBooleanProperty ready;
    private SimpleBooleanProperty isEdited;

    WriterSceneView(Stage window){
        tableOfContent = new HeadingPaneControl();
        userLists = new NotesPaneControl();
        langCheatsheet = new CheatsheetPaneControl();

<<<<<<< HEAD
        manuscriptFile = new SimpleObjectProperty<>(this, "manuscriptFile");
        manuscriptFile.addListener((data, oldValue, newValue) ->
            changeDoc(newValue));

        getStylesheets().add("data/main.css");
        textArea = initTextPane();
        VBox top = new VBox();
        WriterMenuBar menu = initMenuBar(window);
        top.getChildren().addAll(menu);
=======
        getStylesheets().add("data/main.css");

        manuscriptFile = new SimpleObjectProperty<>(this, "manuscriptFile");
        manuscriptFile.addListener((data, oldValue, newValue) ->
            changeDoc(newValue));

        textArea = initTextPane();
        textArea.textChangedProperty().addListener((data, oldValue, newValue) ->
            textChanged(newValue));
        textArea.caretPlacedProperty().addListener((data, oldValue, newValue) ->
            caretChanged(newValue.intValue()));

        VBox top = new VBox();
        WriterMenuBar menu = initMenuBar(window, top);
>>>>>>> fada46eeaabae6262e901a2e482ef1edfe764579
        setTop(menu);

        agendaPane = initAgendaPane();
/*
        textArea.textChangedProperty().addListener((data, oldValue, newValue) ->
            textChanged(newValue));
/*
        textArea.textChangedProperty().addListener((data, oldValue, newValue) ->
            listenTextChange(newValue));
        textArea.caretPlacedProperty().addListener((data, oldValue, newValue) ->
            listenCaret(newValue.intValue()));
*/
        //agendaPane.agendaFocusedProperty().addListener((data, oldValue,
        //    newValue) -> cursorMoved(newValue.getRange()));

        agendaPane.agendaSelectedProperty().addListener(
            (data, oldValue, newValue) -> Optional.ofNullable(newValue)
                .ifPresent(value -> selectionChanged(value.getRange()))
        );

/*
        tableOfContent.headingFocusedProperty().addListener((data, oldValue,
            newValue) -> listenHeading(newValue));
        tableOfContent.outlineFocusedProperty().addListener((data, oldValue,
            newValue) -> listenOutline(newValue));

        userLists.toLocationProperty().addListener((data, oldValue, newValue)
            -> listenLocClicked(newValue.intValue()));
        userLists.childFocusedProperty().addListener((data, oldValue, newValue)
            -> listenListFocused(newValue));
*/
        ready = new SimpleBooleanProperty(this, "ready", false);
        isEdited = new SimpleBooleanProperty(this, "isEdited", false);
/*
        layoutLeftPane();
        layoutRightPane();
        layoutTopPane(window);
        layoutBottomPane();
        layoutCenterPane();

        controlSetup();*/
    }

    /// Layout Nodes
    private TextPaneControl initTextPane(){
        TextPaneControl out = new TextPaneControl();
        setCenter(out);
        return out;
    }

<<<<<<< HEAD
    private WriterMenuBar initMenuBar(Stage window){
        WriterMenuBar ans = new WriterMenuBar(window);
        ans.manuscriptFileProperty().bindBidirectional(manuscriptFile);
=======
    private WriterMenuBar initMenuBar(Stage window, Pane top){
        WriterMenuBar ans = new WriterMenuBar(window);
        ans.manuscriptFileProperty().bindBidirectional(manuscriptFile);
        top.getChildren().addAll(ans);
>>>>>>> fada46eeaabae6262e901a2e482ef1edfe764579
        return ans;
    }
/*

<<<<<<< HEAD
=======
    private AgendaPaneControl initAgendaPane(){
        AgendaPaneControl ans = new AgendaPaneControl();
        setRight(ans);
        return ans;
    }
/*

>>>>>>> fada46eeaabae6262e901a2e482ef1edfe764579
    private void layoutLeftPane(){
        setLeft(tableOfContent);
    }

    private void layoutCenterPane(){
        setCenter(textArea);
    }

    private void layoutRightPane(){
        setRight(agendaPane);
    }

    private void layoutTopPane(Stage window){
        VBox pane = new VBox();
        WriterMenuBar bar = new WriterMenuBar(window);
        bar.manuscriptFileProperty().bindBidirectional(manuscriptFile);

        pane.getChildren().addAll(bar, userLists);
        setTop(pane);
    }

    private void layoutBottomPane(){
        setBottom(langCheatsheet);
    }*/

    /// Getters
    protected TextPaneControl getTextArea(){
        return textArea;
    }

    protected HeadingPaneControl getTableOfContent(){
        return tableOfContent;
    }

    protected AgendaPaneControl getAgendaPane(){
        return agendaPane;
    }

    protected NotesPaneControl getUserLists(){
        return userLists;
    }

    protected CheatsheetPaneControl getCheatsheet(){
        return langCheatsheet;
    }

    /// Node Properties
    public ObjectProperty<ManuscriptFile> manuscriptFileProperty(){
        return manuscriptFile;
    }

    public ManuscriptFile getManuscriptFile(){
        return manuscriptFile.getValue();
    }

    public void setManuscriptFile(ManuscriptFile doc){
        manuscriptFile.setValue(doc);
    }

    public BooleanProperty readyProperty(){
        return ready;
    }

    public boolean isTextReady(){
        return ready.get();
    }

    public void setTextReady(boolean bool){
        ready.setValue(bool);
    }

    public BooleanProperty isEditedProperty(){
        return isEdited;
    }

    public boolean isEdited(){
        return isEdited.get();
    }

    public void setUpdateded(boolean bool){
        isEdited.setValue(bool);
    }

    /// Control Methods
    protected abstract void changeDoc(ManuscriptFile file);

    protected abstract void textChanged(PlainTextChange changes);

<<<<<<< HEAD
=======
    protected abstract void selectionChanged(Range<Integer> range);

    protected abstract void caretChanged(int position);

>>>>>>> fada46eeaabae6262e901a2e482ef1edfe764579
    /*protected abstract void controlSetup();

    protected abstract void listenDoc();

    protected abstract void listenTextChange(PlainTextChange changes);

    protected abstract void listenCaret(int moveTo);

    protected abstract void listenAgenda(boolean focused);

    protected abstract void listenHeading(boolean focused);

    protected abstract void listenOutline(boolean focused);

    protected abstract void listenLocClicked(int loc);

    protected abstract void listenListFocused(boolean focused);*/
}